@page "/shelter/dashboard"
@using Microsoft.AspNetCore.Authorization
@using System.Security.Claims
@using PAWPALme.Models
@using PAWPALme.Repositories
@inject AuthenticationStateProvider AuthStateProvider
@inject IShelterRepository ShelterRepo
@inject NavigationManager Nav
@attribute [Authorize(Roles = "Shelter")]

<PageTitle>Shelter Dashboard | PawPal</PageTitle>

<div class="container py-5">

    @if (_myShelter == null)
    {
        <div class="text-center py-5">
            <div class="spinner-border text-primary"></div>
        </div>
    }
    else
    {
        <div class="text-center mb-5">
            <h1 class="display-4 fw-bold text-dark mb-2">
                @_myShelter.Name
            </h1>
            <p class="text-muted">Command Center</p>
        </div>

        <div class="row g-4 justify-content-center">

            <div class="col-md-4">
                <a href="shelter/pets" class="glass-action-card h-100 text-decoration-none">
                    <div class="icon-circle bg-blue-soft text-primary">
                        <i class="bi bi-folder-plus"></i>
                    </div>
                    <h3 class="fw-bold text-dark mt-4">Manage Pets</h3>
                    <p class="text-muted small">Update your animal database.</p>
                </a>
            </div>

            <div class="col-md-4">
                <a href="shelter/appointments" class="glass-action-card h-100 text-decoration-none">
                    <div class="icon-circle bg-purple-soft text-purple">
                        <i class="bi bi-calendar-week"></i>
                    </div>
                    <h3 class="fw-bold text-dark mt-4">Appointments</h3>
                    <p class="text-muted small">View requests & schedule.</p>
                </a>
            </div>

            <div class="col-md-4">
                <a href="shelter/settings" class="glass-action-card h-100 text-decoration-none">
                    <div class="icon-circle bg-red-soft text-danger">
                        <i class="bi bi-gear"></i>
                    </div>
                    <h3 class="fw-bold text-dark mt-4">Settings</h3>
                    <p class="text-muted small">Profile, Account & Logout.</p>
                </a>
            </div>

        </div>
    }
</div>

@code {
    private Shelter? _myShelter;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;
        var userId = user.FindFirst(c => c.Type == ClaimTypes.NameIdentifier)?.Value;

        // Fetch Shelter
        var allShelters = await ShelterRepo.GetAllAsync();
        _myShelter = allShelters.FirstOrDefault(s => s.OwnerUserId == userId);
    }
}